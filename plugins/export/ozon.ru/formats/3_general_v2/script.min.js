var DataExpPopupOzonConstructor;
$(document).ready(function(){function d(){data={x1:"ok1",x3:"ok3"};dataExpAjax(["plugin_ajax_action","load_attr"],data,function(a,b,c){$(".res_load_attributes").html(a.Text);"next"==a.Status&&d();console.log(a)},function(a){console.log(a)},!0)}$(document).delegate('input[data-role="update_items_status"]',"click",function(a){data={x1:"ok1",x3:"ok3"};dataExpAjax(["plugin_ajax_action","update_items_status"],data,function(a,c,e){$(".ozone-status-table").html(a.Text);console.log(a)},function(a){console.log(a)},
!0)});$(document).delegate(".run_sync_ext_id","click",function(a){console.log("run_sync_ext_id click");data={x1:"ok1",x3:"ok3"};dataExpAjax(["plugin_ajax_action","sync_ext_id"],data,function(a,c,e){$(".sync_ext_id_div").html(a.Text);console.log(a)},function(a){console.log(a)},!0)});$(document).delegate(".run_load_attributes","click",function(a){console.log("run_load_attributes");d()});DataExpPopupOzonConstructor=new BX.CDialog({ID:"DataExpPopupOzonConstructor",title:BX.message("DATA_EXP_POPUP_EXECUTE_TITLE"),
content:"",resizable:!0,draggable:!0,height:350,width:500});DataExpPopupOzonConstructor.Open=function(){this.repeatDelay=dataExpExportTimeDelay&&0<dataExpExportTimeDelay?dataExpExportTimeDelay:50;this.Stopped=!1;this.Show();this.LoadContent()};DataExpPopupOzonConstructor.LoadContent=function(){var a=this;a.SetContent(BX.message("DATA_EXP_POPUP_LOADING"));a.SetNavButtons();a.EnableControls();dataExpAjax(["plugin_ajax_action","build_constructor"],"",function(b,c,e){$(a.PARTS.CONTENT_DATA).children(".bx-core-adm-dialog-content-wrap-inner").children().html(b.Text);
$(".bx-core-adm-dialog-content-wrap-inner",a.DIV).css({height:"100%","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}).children().css({height:"100%"})},function(a){},!0)};DataExpPopupOzonConstructor.SetNavButtons=function(){$(this.PARTS.BUTTONS_CONTAINER).html("");this.SetButtons([{name:BX.message("DATA_EXP_POPUP_EXECUTE_BUTTON_START"),className:"adm-btn-green",id:"data-exp-popup-execute-button-start",action:function(){var a=this.parentWindow;a.Stopped=
!1;a.Execute({first:!0})}},{name:BX.message("DATA_EXP_POPUP_EXECUTE_BUTTON_STOP"),id:"data-exp-popup-execute-button-stop",action:function(){var a=this.parentWindow;a.Stop();a.SetContent(BX.message("DATA_EXP_POPUP_EXECUTE_STOPPED"))}},{name:BX.message("DATA_EXP_POPUP_CLOSE"),id:"data-exp-popup-execute-button-close",action:function(){this.parentWindow.Close()}}])};DataExpPopupOzonConstructor.DisableControls=function(){$("#data-exp-popup-execute-button-start",this.DIV).attr("disabled","disabled");
$("#data-exp-popup-execute-button-stop",this.DIV).removeAttr("disabled")};DataExpPopupOzonConstructor.EnableControls=function(){$("#data-exp-popup-execute-button-start",this.DIV).removeAttr("disabled");$("#data-exp-popup-execute-button-stop",this.DIV).attr("disabled","disabled")};DataExpPopupOzonConstructor.Execute=function(a){var b=this;b.Stopped||(void 0==a&&(a={}),b.DisableControls(),b.AjaxRequest=dataExpAjax("export_execute",a,function(c,e,d){$(b.PARTS.CONTENT_DATA).children(".bx-core-adm-dialog-content-wrap-inner").children().html(c.HTML);
$(".bx-core-adm-dialog-content-wrap-inner",b.DIV).css({height:"100%","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}).children().css({height:"100%"});setTimeout(function(){c.Repeat?(a.first=!1,b.Stopped||b.Execute(a)):c.Success?(b.EnableControls(),dataExpUpdateLogAndHistory()):(1==c.ShowError&&(c.HTML?b.SetContent(c.HTML):b.SetContent(BX.message("DATA_EXP_POPUP_EXECUTE_ERROR"))),b.EnableControls())},b.repeatDelay);void 0!=c.LockedHtml&&$("#data-exp-lock-notifier").html(c.LockedHtml);
dataExpHandleAjaxError(d,!1)},function(a){b.SetContent(BX.message("DATA_EXP_POPUP_EXECUTE_ERROR"));dataExpHandleAjaxError(a,!0);b.EnableControls()},!0))};DataExpPopupOzonConstructor.Stop=function(){this.Stopped=!0;this.EnableControls();this.AjaxRequest&&4!=this.AjaxRequest.readyState&&this.AjaxRequest.abort();dataExpAjax("profile_unlock","",null,null,!1,!1)};BX.addCustomEvent("onWindowClose",function(a){a==DataExpPopupOzonConstructor&&DataExpPopupOzonConstructor.Stop()})});